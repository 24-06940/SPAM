<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Maintenance Checklist | SPAM</title>
  <link rel="stylesheet" href="../custom.css">
  <style>
    .form-row {
      display: flex;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .form-group {
      flex: 1;
      min-width: 250px;
      margin-right: 20px;
    }
    
    .form-group:last-child {
      margin-right: 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
      font-size: 14px;
    }
    
    textarea.form-control {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .form-actions button {
      margin-left: 10px;
    }
    
    .checklist-task {
      background-color: #f5f5f5;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
    }
    
    .remove-task {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
    }
    
    .remove-task:hover {
      color: #f44336;
    }
    
    .add-task-button {
      display: flex;
      align-items: center;
      background-color: transparent;
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 15px;
      width: 100%;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      color: #666;
      margin-bottom: 20px;
    }
    
    .add-task-button:hover {
      border-color: #542583;
      color: #542583;
    }
    
    .add-task-button svg {
      margin-right: 10px;
    }
    
    .success-message {
      background-color: #e6f4ea;
      color: #0d652d;
      padding: 16px;
      border-radius: 4px;
      margin-bottom: 24px;
      border-left: 4px solid #34a853;
      display: none;
    }
    
    .warning-message {
      background-color: #fef7e0;
      color: #b06000;
      padding: 16px;
      border-radius: 4px;
      margin-bottom: 24px;
      border-left: 4px solid #f9ab00;
      display: none;
    }
    
    .task-list {
      margin-top: 30px;
    }
    
    @media (max-width: 768px) {
      .form-group {
        width: 100%;
        margin-right: 0;
        margin-bottom: 15px;
      }
    }
    
    .success-message {
      background-color: #e6f4ea;
      color: #0d652d;
      padding: 16px;
      border-radius: 4px;
      margin-bottom: 24px;
      border-left: 4px solid #34a853;
      display: none;
    }
    
    .warning-message {
      background-color: #fef7e0;
      color: #b06000;
      padding: 16px;
      border-radius: 4px;
      margin-bottom: 24px;
      border-left: 4px solid #f9ab00;
      display: none;
    }
  </style>
</head>
<body>
  <div class="page-header">
    <div style="display: flex; align-items: center;">
      <a href="../index.html" class="home-button" title="Return to Home">
        <div class="spam-logo">SPAM</div>
      </a>
      <h1>Create Maintenance Checklist</h1>
    </div>
  </div>
  
  <div class="container">
    <div class="success-message" id="success-message">
      <strong>Success!</strong> The checklist has been created successfully.
    </div>
    
    <div class="warning-message" id="warning-message">
      <strong>Warning:</strong> Some fields are incomplete. The checklist has been saved with partial data.
    </div>
    
    <form id="checklist-form">
      <div class="form-row">
        <div class="form-group">
          <label for="checklist-title">Checklist Title</label>
          <input type="text" id="checklist-title" class="form-control" required>
        </div>
        
        <div class="form-group">
          <label for="equipment-type">Equipment Type</label>
          <select id="equipment-type" class="form-control" required>
            <option value="">Select Equipment Type</option>
            <option value="transmitters">Transmitters</option>
            <option value="valves">Valves</option>
            <option value="gauges">Gauges</option>
            <option value="analyzers">Analyzers</option>
            <option value="test-equipment">Test Equipment</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="frequency">Maintenance Frequency</label>
          <select id="frequency" class="form-control" required>
            <option value="">Select Frequency</option>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="biweekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
            <option value="quarterly">Quarterly</option>
            <option value="biannual">Bi-annual</option>
            <option value="annual">Annual</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="priority">Priority</label>
          <select id="priority" class="form-control" required>
            <option value="">Select Priority</option>
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group" style="flex: 2;">
          <label for="description">Checklist Description</label>
          <textarea id="description" class="form-control" required></textarea>
        </div>
      </div>
      
      <div class="task-list">
        <h3>Maintenance Tasks</h3>
        <p>Add specific tasks to include in this maintenance checklist.</p>
        
        <div id="tasks-container">
          <!-- Tasks will be added here by JS -->
        </div>
        
        <button type="button" id="add-task-btn" class="add-task-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
          Add New Task
        </button>
      </div>
      
      <div class="form-actions">
        <a href="../checklists.html" class="secondary-button">Cancel</a>
        <button type="submit" class="primary-button">Save Checklist</button>
      </div>
    </form>
  </div>
  
  <script>
    // Task template HTML
    function createTaskHTML(index) {
      return `
        <div class="checklist-task" id="task-${index}">
          <button type="button" class="remove-task" onclick="removeTask(${index})">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
          </button>
          <div class="form-row">
            <div class="form-group">
              <label for="task-name-${index}">Task Name</label>
              <input type="text" id="task-name-${index}" name="task-name-${index}" class="form-control" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group" style="flex: 2;">
              <label for="task-description-${index}">Task Description</label>
              <textarea id="task-description-${index}" name="task-description-${index}" class="form-control"></textarea>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="task-expected-value-${index}">Expected Value/Range (if applicable)</label>
              <input type="text" id="task-expected-value-${index}" name="task-expected-value-${index}" class="form-control">
            </div>
            <div class="form-group">
              <label for="task-tools-${index}">Required Tools</label>
              <input type="text" id="task-tools-${index}" name="task-tools-${index}" class="form-control">
            </div>
          </div>
        </div>
      `;
    }
    
    // Add task to form
    let taskCount = 0;
    
    document.getElementById('add-task-btn').addEventListener('click', function() {
      const tasksContainer = document.getElementById('tasks-container');
      
      // Create new task element
      taskCount++;
      tasksContainer.insertAdjacentHTML('beforeend', createTaskHTML(taskCount));
    });
    
    // Remove task from form
    window.removeTask = function(index) {
      const taskElement = document.getElementById(`task-${index}`);
      if (taskElement) {
        taskElement.remove();
      }
    };
    
    // Form submission
    document.getElementById('checklist-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Hide any previously shown messages
      document.getElementById('success-message').style.display = 'none';
      document.getElementById('warning-message').style.display = 'none';
      
      const title = document.getElementById('checklist-title').value;
      const equipmentType = document.getElementById('equipment-type').value;
      const frequency = document.getElementById('frequency').value;
      const description = document.getElementById('description').value;
      const priority = document.getElementById('priority').value;
      
      // Gather task data
      const tasks = [];
      document.querySelectorAll('.checklist-task').forEach(taskElement => {
        const taskId = taskElement.id.split('-')[1];
        const taskName = document.getElementById(`task-name-${taskId}`).value;
        const taskDescription = document.getElementById(`task-description-${taskId}`).value;
        const taskExpectedValue = document.getElementById(`task-expected-value-${taskId}`).value;
        const taskTools = document.getElementById(`task-tools-${taskId}`).value;
        
        tasks.push({
          name: taskName,
          description: taskDescription,
          expectedValue: taskExpectedValue,
          tools: taskTools
        });
      });
      
      // Check only for optional incomplete fields
      // We don't need to check required fields as HTML5 validation handles that
      const hasIncompleteData = tasks.some(task => 
        !task.description || !task.expectedValue || !task.tools
      );
      
      // For incomplete data - Ask the user if they want to continue
      if (hasIncompleteData) {
        console.log('Incomplete task data detected');
        // Show confirmation dialog
        const confirmSubmit = confirm("Some optional task fields (descriptions, expected values, or tools) are incomplete. Do you want to continue with partial data?");
        console.log('User confirmation:', confirmSubmit);
        if (!confirmSubmit) {
          console.log('User canceled submission');
          return; // User chose to cancel and complete the form
        }
        console.log('Proceeding with incomplete data');
      }
      
      // Create checklist object
      const checklist = {
        id: 'checklist_' + Date.now(),
        title: title || 'Untitled Checklist',
        equipmentType: equipmentType || 'Unspecified',
        frequency: frequency || 'Unspecified',
        description: description || 'No description provided',
        tasks,
        createdDate: new Date().toISOString(),
        priority: priority || 'medium'
      };
      
      // Store in localStorage
      let checklists = JSON.parse(localStorage.getItem('checklists') || '[]');
      checklists.push(checklist);
      localStorage.setItem('checklists', JSON.stringify(checklists));
      
      // Show success message
      document.getElementById('success-message').style.display = 'block';
      
      // Scroll to top to show message
      window.scrollTo(0, 0);
      
      // Reset form and redirect after a delay
      setTimeout(() => {
        window.location.href = '../checklists.html';
      }, 1500);
    });
    
    // Add one task by default when page loads
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('add-task-btn').click();
    });
  </script>
</body>
</html>